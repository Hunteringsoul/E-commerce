<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Profile ¬∑ Sportify</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>

    <header class="navbar">
        <div class="logo">Sportify</div>
        <nav>
            <a href="index.html">Home</a>
            <a href="index.html#products">Products</a>
            <a href="index.html#features">Features</a>
            <a href="index.html#contact">Contact</a>
        </nav>

        <div class="navbar-right">
            <div id="userMenu" class="user-menu">
                <span id="userName" class="user-name"></span>
                <div class="user-dropdown">
                    <a href="profile.html">My Profile</a>
                    <a href="#" onclick="handleLogout(); return false;">Logout</a>
                </div>
            </div>
            <button class="wishlist-icon" type="button" onclick="openWishlist()">
                ‚ù§Ô∏è <span id="wishlistCount">0</span>
            </button>
            <button class="cart-icon" type="button" onclick="openCart()">
                üõí <span id="cartCount">0</span>
            </button>
        </div>
    </header>

    <main class="profile-page">
        <div class="profile-container">
            <h1>My Profile</h1>

            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar">
                        <span id="profileInitials"></span>
                    </div>
                    <div class="profile-info">
                        <h2 id="profileName"></h2>
                        <p id="profileEmail"></p>
                        <p class="profile-join-date">Member since <span id="profileJoinDate"></span></p>
                    </div>
                </div>

                <div class="profile-stats">
                    <div class="stat-item">
                        <h3 id="totalOrders">0</h3>
                        <p>Orders</p>
                    </div>
                    <div class="stat-item">
                        <h3 id="wishlistItemsCount">0</h3>
                        <p>Wishlist Items</p>
                    </div>
                    <div class="stat-item">
                        <h3 id="cartItemsCount">0</h3>
                        <p>Cart Items</p>
                    </div>
                </div>
            </div>

            <div class="profile-section">
                <h3>Account Settings</h3>
                <div class="settings-list">
                    <div class="setting-item">
                        <span>Email Notifications</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="emailNotifications" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <span>Favorite Brands</span>
                        <div class="favorite-brands">
                            <button class="brand-tag" onclick="toggleFavoriteBrand('Nike')">Nike</button>
                            <button class="brand-tag" onclick="toggleFavoriteBrand('Adidas')">Adidas</button>
                            <button class="brand-tag" onclick="toggleFavoriteBrand('Puma')">Puma</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-section">
                <h3>Order History</h3>
                <div id="orderHistory" class="order-history">
                    <p class="no-orders">No orders yet. Start shopping to see your order history here!</p>
                </div>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        // Profile page specific code
        document.addEventListener("DOMContentLoaded", () => {
            const user = getCurrentUser();
            
            if (!user) {
                window.location.href = "login.html";
                return;
            }

            // Update navbar
            updateUserNav();
            loadCartFromStorage();
            loadWishlistFromStorage();

            // Display user info
            document.getElementById("profileName").textContent = user.name;
            document.getElementById("profileEmail").textContent = user.email;
            
            const initials = user.name.split(" ").map(n => n[0]).join("").toUpperCase();
            document.getElementById("profileInitials").textContent = initials;
            
            if (user.joinDate) {
                const date = new Date(user.joinDate);
                document.getElementById("profileJoinDate").textContent = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long' 
                });
            }

            // Update stats
            const orders = user.orderHistory || [];
            document.getElementById("totalOrders").textContent = orders.length;
            document.getElementById("wishlistItemsCount").textContent = wishlist.length;
            document.getElementById("cartItemsCount").textContent = cart.length;

            // Render order history
            const historyContainer = document.getElementById("orderHistory");
            historyContainer.innerHTML = "";
            if (orders.length === 0) {
                historyContainer.innerHTML = '<p class="no-orders">No orders yet. Start shopping to see your order history here!</p>';
            } else {
                orders.forEach(order => {
                    const date = new Date(order.placedAt);
                    const prettyDate = date.toLocaleString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    const itemsHtml = (order.items || []).map(item => `
                        <li>
                            <span>${item.name}</span>
                            <span>‚Çπ${item.price.replace('‚Çπ','')} √ó ${item.quantity}</span>
                        </li>
                    `).join("");

                    historyContainer.innerHTML += `
                        <div class="order-card">
                            <div class="order-header">
                                <span class="order-id">Order #${order.id}</span>
                                <span class="order-date">${prettyDate}</span>
                            </div>
                            <ul class="order-items">
                                ${itemsHtml}
                            </ul>
                            <div class="order-total">
                                <span>Total</span>
                                <strong>‚Çπ${order.total}</strong>
                            </div>
                        </div>
                    `;
                });
            }

            // Load saved preferences
            if (user.preferences) {
                if (user.preferences.notifications !== undefined) {
                    document.getElementById("emailNotifications").checked = user.preferences.notifications;
                }
                // Activate favorite brand tags
                updateBrandTags();
            }
        });

        function toggleFavoriteBrand(brand) {
            const user = getCurrentUser();
            if (!user) return;

            if (!user.preferences) user.preferences = {};
            if (!user.preferences.favoriteBrands) user.preferences.favoriteBrands = [];

            const index = user.preferences.favoriteBrands.indexOf(brand);
            if (index > -1) {
                user.preferences.favoriteBrands.splice(index, 1);
            } else {
                user.preferences.favoriteBrands.push(brand);
            }

            setCurrentUser(user);
            updateBrandTags();
            showToast("Preferences saved!");
        }

        function updateBrandTags() {
            const user = getCurrentUser();
            if (!user || !user.preferences || !user.preferences.favoriteBrands) return;

            document.querySelectorAll(".brand-tag").forEach(tag => {
                const brand = tag.textContent;
                if (user.preferences.favoriteBrands.includes(brand)) {
                    tag.classList.add("active");
                } else {
                    tag.classList.remove("active");
                }
            });
        }

        document.getElementById("emailNotifications").addEventListener("change", function() {
            const user = getCurrentUser();
            if (!user) return;

            if (!user.preferences) user.preferences = {};
            user.preferences.notifications = this.checked;
            setCurrentUser(user);
            showToast("Settings saved!");
        });
    </script>
</body>
</html>
